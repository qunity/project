services:
  php-fpm:
    environment:
      - NODE_ENV=development
      - MAGENTO_BACKEND_URL=https://${TRAEFIK_SUBDOMAIN}.${TRAEFIK_DOMAIN}/
      - DEV_SERVER_PORT=${PWA_DEV_SERVER_PORT}
      - STAGING_SERVER_PORT=${PWA_STAGING_SERVER_PORT}
      - ROOTCA_HTTPS_CERT=/etc/ssl/warden-rootca-cert/ca.cert.pem
      - CUSTOM_HTTPS_KEY=/etc/ssl/warden-ssl-certs/${TRAEFIK_DOMAIN}.key.pem
      - CUSTOM_HTTPS_CERT=/etc/ssl/warden-ssl-certs/${TRAEFIK_DOMAIN}.crt.pem
    ports:
      - ${TRAEFIK_LISTEN:-127.0.0.1}:${PWA_DEV_SERVER_PORT}:${PWA_DEV_SERVER_PORT}
      - ${TRAEFIK_LISTEN:-127.0.0.1}:${PWA_STAGING_SERVER_PORT}:${PWA_STAGING_SERVER_PORT}
    volumes:
      - type: bind
        source: ./${WARDEN_PWA_ROOT}
        target: /var/www/pwa
        bind:
          create_host_path: true
      - type: bind
        source: ${HOME}/.warden/ssl/certs/${TRAEFIK_DOMAIN}.key.pem
        target: /etc/ssl/warden-ssl-certs/${TRAEFIK_DOMAIN}.key.pem
        read_only: true
        bind:
          create_host_path: false
      - type: bind
        source: ${HOME}/.warden/ssl/certs/${TRAEFIK_DOMAIN}.crt.pem
        target: /etc/ssl/warden-ssl-certs/${TRAEFIK_DOMAIN}.crt.pem
        read_only: true
        bind:
          create_host_path: false
